# Testing the Microservice

You have three options to test this logging microservice:
1. Run it locally.
2. Run it locally but containerized.
3. Run it in a cluster.

For options 1 or 2, please navigate to `src/` directory.
For option 3, please navigate to `kube-manifests/` directory.

# Architecture

The microservice has 3 endpoints:
1. `/generatetoken` - Used to generate a JWT token for authentication.
2. `/events/submit` - Used to submit events.
3. `/events/query` - Used to query submitted events.

The first endpoint exists for test purposes to validate that the authentication is functioning correctly for the second and third endpoints.

The file structure of the application is as follows:
- `main.go` - Application entry point.
- `server/` - Layer responsible for the HTTP server.
- `storage/` - Layer responsible for communicating with the storage.
- `services/` - Layer responsible for utilizing the underlying storage.
- `models/` - Contains custom data structures.
- `config/` - Layer responsible for microservice configuration.
- `auth/` - Layer responsible for handling authentication middleware.
- `api/` - Layer responsible for API definitions and endpoint handlers.

The data structure for events is defined as follows:

```go
type Event struct {
    EventID               string                 `bson:"EventID" json:"EventID"`                             // Event Unique ID generated by the audit log
    Timestamp             time.Time              `bson:"Timestamp" json:"Timestamp"`                         // Timestamp in nanoseconds of the moment the audit log received the event
    SourceEventID         string                 `bson:"SourceEventID" json:"SourceEventID"`                 // Event ID provided by the source service
    SourceTimestamp       time.Time              `bson:"SourceTimestamp" json:"SourceTimestamp"`             // Timestamp in nanoseconds provided by the source service
    CorrelationID         string                 `bson:"CorrelationID" json:"CorrelationID"`                 // Event correlation ID in case other events are related
    SourceTimezone        string                 `bson:"SourceTimezone" json:"SourceTimezone"`               // Timezone of source service
    SourceServiceName     string                 `bson:"SourceServiceName" json:"SourceServiceName"`         // Name of source service
    SourceServiceLocation string                 `bson:"SourceServiceLocation" json:"SourceServiceLocation"` // Source service geographical information
    SourceIPAddress       string                 `bson:"SourceIPAddress" json:"SourceIPAddress"`             // Source service IP address
    EventTags             map[string]string      `bson:"EventTags" json:"EventTags"`                         // Event metadata
    EventDataHash         string                 `bson:"EventDataHash" json:"EventDataHash"`                 // Event data hash or checksum for integrity
    EventDataVersion      string                 `bson:"EventDataVersion" json:"EventDataVersion"`           // Event data version
    EventData             map[string]interface{} `bson:"EventData" json:"EventData"`                         // Variant event data depending on their type
}
```
The attributes before EventData are part of the invariant data, while EventData captures the variant data that an event might have. This structure allows accepting events with any payload as EventData without the need to modify the code. Note that not all invariant data is required, and the first two attributes are generated by this microservice.
